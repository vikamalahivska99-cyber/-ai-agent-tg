# Telegram Bug Report Bot (Go)

Телеграм-бот на Go, який приймає фото/скріншот багу, надсилає зображення в мок-сервіс аналізу та повертає користувачу опис багу у вигляді тест-кейсів.

## Вимоги

- Встановлений **Go** (версія 1.21+)
- Аккаунт Telegram і токен бота від **@BotFather**

## Клонування з GitHub

```bash
git clone https://github.com/ВАШ_ЛОГІН/НАЗВА_РЕПО.git
cd НАЗВА_РЕПО
```

Створіть файл `.env` у корені проєкту (його немає в репозиторії через безпеку) і додайте туди токен та режим аналізу, наприклад:

```
TELEGRAM_BOT_TOKEN=ваш_токен_від_BotFather
ANALYSIS_MODE=mock
```

Далі — див. розділ «Налаштування» та «Запуск».

## Налаштування

1. Створіть бота через `@BotFather` і отримайте токен.
2. Встановіть змінну середовища з токеном:

   **PowerShell (Windows):**
   ```powershell
   $env:TELEGRAM_BOT_TOKEN="ВАШ_ТОКЕН_ТУТ"
   ```

   **bash/zsh (Linux/macOS):**
   ```bash
   export TELEGRAM_BOT_TOKEN="ВАШ_ТОКЕН_ТУТ"
   ```

3. (Одноразово) Ініціалізуйте залежності Telegram API, якщо потрібно:

   ```bash
   go get github.com/go-telegram-bot-api/telegram-bot-api/v5
   go mod tidy
   ```

## Безкоштовний AI-аналіз зображень (локально через Ollama)

Щоб бот **реально аналізував скріншот** і генерував тест-кейси з нього (без платних API), потрібен **запущений Ollama** з vision-моделлю.

1. Встановіть Ollama: **https://ollama.com/download**
2. Завантажте vision-модель (один раз):
   ```powershell
   ollama pull llava
   ```
3. **Запустіть Ollama** — відкрийте додаток Ollama або в терміналі:
   ```powershell
   ollama serve
   ```
   (Сервер має слухати на `http://127.0.0.1:11434`.)
4. Увімкніть режим аналізу й запустіть бота:
   ```powershell
   $env:TELEGRAM_BOT_TOKEN="ваш_токен"
   $env:ANALYSIS_MODE="ollama"
   $env:OLLAMA_URL="http://127.0.0.1:11434"
   $env:OLLAMA_MODEL="llava"
   go run ./cmd/bot
   ```
   У консолі має з’явитися: `Ollama is reachable; AI analysis enabled.` Якщо замість цього попередження про недоступність Ollama — спочатку запустіть Ollama (крок 3).

## Запуск

Проєкт містить `Makefile` з базовими командами.

- **Зібрати бота:**

  ```bash
  make build
  ```

- **Запустити бота:**

  ```bash
  make run
  ```

- **Запустити тести:**

  ```bash
  make test
  ```

## Як це працює

1. Користувач надсилає боту фото або зображення-документ.
2. Бот завантажує файл з Telegram через `getFile`.
3. Зображення передається в аналізатор (`internal/analysis`):
   - `mock` (за замовчуванням) — завжди повертає один і той самий приклад тест-кейсів
   - `ollama` — локально аналізує зображення та генерує тест-кейси без платних API
4. Результат надсилається користувачу у вигляді структурованих тест-кейсів.

### Чому Ollama не працює? (чекліст)

1. **Увімкнений режим Ollama**  
   У файлі `.env` (в корені проєкту) має бути:
   ```env
   ANALYSIS_MODE=ollama
   ```
   Якщо стоїть `mock` або змінна не задана — бот **ніколи** не викликає Ollama, тільки мок.  
   Тепер бот при старті сам підвантажує `.env`; перезапустіть бота після зміни.

2. **Ollama запущений**  
   Відкрийте додаток Ollama або в терміналі: `ollama serve`.  
   Сервер має слухати на `http://127.0.0.1:11434`.

3. **Модель завантажена**  
   Для фото потрібна vision-модель: `ollama pull llava`.  
   Для лише тексту підійде й звичайна модель, наприклад `ollama pull llama3.2`; у `.env` тоді можна вказати `OLLAMA_MODEL=llama3.2`.

4. **Що бачити в консолі при старті**  
   - Якщо все ок: `analysis mode: ollama` і далі `Ollama is reachable; AI analysis enabled.`  
   - Якщо Ollama вимкнений: `WARNING: ollama not reachable at ...` — спочатку запустіть Ollama (крок 2).

5. **Запуск з .env**  
   Запускайте бота з тієї папки, де лежить `.env` (корінь проєкту), наприклад: `go run ./cmd/bot` або `make run`.

### Якщо замість аналізу скріна приходять лише шаблони

- Переконайтеся, що **Ollama запущений** (відкритий додаток або `ollama serve`).
- Перевірте в консолі при старті бота: має бути рядок `Ollama is reachable; AI analysis enabled.`
- Перевірте, що в `.env` стоїть **`ANALYSIS_MODE=ollama`** (не `mock`).
- Використовуйте `OLLAMA_URL="http://127.0.0.1:11434"` (на Windows краще ніж localhost).
- Один раз виконайте `ollama pull llava`.
- Після запуску Ollama можна знову надіслати фото — перезапуск бота не обов’язковий.

